<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ú–∞–≥–∞–∑–∏–Ω –ü—Ä–æ–¥—É–∫—Ç–æ–≤</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    .category-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      margin: 20px 0;
    }
    .category-card, .subcategory-card {
      background: white;
      padding: 28px 8px;
      text-align: center;
      border-radius: 12px;
      font-size: 22px;
      font-weight: 500;
      cursor: pointer;
      transition: box-shadow .18s;
      box-shadow: 0 0 7px #d0d0d0;
      border: 1px solid #eaeaea;
      user-select: none;
    }
    .category-card:hover, .subcategory-card:hover {
      box-shadow: 0 0 16px #b7c7e2;
      background: #f6faff;
    }
    .products-list {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 18px;
      margin: 22px 0;
    }
    .product-card {
      background: white;
      border-radius: 10px;
      padding: 13px;
      box-shadow: 0 0 7px #e3e3e3;
      text-align: center;
    }
    .nav-back {
      margin: 18px 0 5px 0;
      padding: 6px 20px;
      border-radius: 7px;
      border: none;
      background: #eee;
      font-size: 18px;
      cursor: pointer;
    }
    .logo-img { max-height: 80px; cursor:pointer;}
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #fff;
      padding: 10px 20px;
      position: sticky;
      top: 0;
      z-index: 999;
      gap: 10px;
    }
    .top-bar .left-menu, .top-bar .right-menu {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .logo-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
    }
    @media (max-width: 900px) {
      .products-list { grid-template-columns: repeat(2, 1fr);}
      .category-grid { grid-template-columns: 1fr;}
    }
    @media (max-width: 600px) {
      .products-list { grid-template-columns: 1fr;}
    }
  </style>
</head>
<body>
  <!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ú–∞–≥–∞–∑–∏–Ω –ü—Ä–æ–¥—É–∫—Ç–æ–≤</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header>
    <div class="top-bar">
      <div class="top-bar-left">
        <button id="login-btn">–í—Ö–æ–¥</button>
        <button id="register-btn">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
      </div>
      <div class="center-bar">
        <button id="phone-btn" class="side-logo-btn">üìû –ó–∞–∫–∞–∑–∞—Ç—å –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É</button>
        <div class="logo-section">
          <div style="font-size: 18px; font-weight: 600; color: #003366; margin-bottom: 3px;">
            –°–ª—É–∂–±–∞ –¥–æ—Å—Ç–∞–≤–∫–∏
          </div>
          <img src="logo.png" alt="–õ–æ–≥–æ—Ç–∏–ø" class="logo-img"/>
        </div>
        <button id="whatsapp-btn" class="side-logo-btn">üí¨ –ù–∞–ø–∏—Å–∞—Ç—å –≤ WhatsApp</button>
      </div>
      <div class="top-bar-right">
        <button id="cart-btn">üõí –ö–æ—Ä–∑–∏–Ω–∞ (0)</button>
      </div>
    </div>
    <div class="search-bar">
      <input type="text" id="search" placeholder="–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤..." />
    </div>
  </header>

  <main>
    <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç —Ç–≤–æ–π –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <section class="categories">
      <div class="category">üßÄ –ú–æ–ª–æ—á–Ω—ã–µ</div>
      <div class="category">ü•ñ –•–ª–µ–±</div>
      <div class="category">üçè –§—Ä—É–∫—Ç—ã</div>
    </section>
  </main>

  <script>
    // –í—Å—Ç–∞–≤—å –∫–æ–¥ –Ω–∏–∂–µ –≤ <script>
    // ...
  </script>
</body>
</html>


  <main>
    <div id="app"></div>
  </main>
  <script>
    let cart = JSON.parse(localStorage.getItem('cart') || '[]');
    let categories = JSON.parse(localStorage.getItem("categories") || "[]");
    let products = JSON.parse(localStorage.getItem("products") || "[]");
    let navStack = []; // –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–Ω–∞–∑–∞–¥"

    function updateCartBtn() {
      let totalCount = 0;
      cart.forEach(item => { totalCount += Number(item.quantity); });
      document.getElementById('cart-btn').innerText = `üõí –ö–æ—Ä–∑–∏–Ω–∞ (${totalCount})`;
    }
    function saveCart() {
      localStorage.setItem('cart', JSON.stringify(cart));
      updateCartBtn();
    }

    // --- –ù–∞–≤–∏–≥–∞—Ü–∏—è
    function renderCategories() {
      navStack = [];
      document.getElementById('search').value = "";
      let html = `<div class="category-grid">`;
      categories.forEach((cat, i) => {
        html += `<div class="category-card" onclick="goToCategory(${i})">${cat.name}</div>`;
      });
      html += `</div>`;
      document.getElementById("app").innerHTML = html;
    }

    window.goToCategory = function(catIndex) {
      navStack.push({type:"root"});
      const cat = categories[catIndex];
      // –ï—Å–ª–∏ –µ—Å—Ç—å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Ö, –∏–Ω–∞—á–µ ‚Äî —Å—Ä–∞–∑—É —Ç–æ–≤–∞—Ä—ã
      if (cat.subcategories && cat.subcategories.length > 0) {
        renderSubcategories(cat, catIndex);
      } else {
        renderProductsList(cat.name, null, cat.name, catIndex);
      }
    }

    function renderSubcategories(cat, catIndex) {
      navStack.push({type:"category", index:catIndex});
      let html = `<button class="nav-back" onclick="navBack()">‚Üê –ù–∞–∑–∞–¥</button>`;
      html += `<h2 style="margin-top:0;">${cat.name}</h2>`;
      html += `<div class="category-grid">`;
      cat.subcategories.forEach((subcat, j) => {
        html += `<div class="subcategory-card" onclick="goToSubcategory(${catIndex},${j})">${subcat}</div>`;
      });
      html += `</div>`;
      // –¢–æ–≤–∞—Ä—ã –±–µ–∑ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚Äî —Ç–æ–∂–µ –≤—ã–≤–æ–¥–∏–º (–µ—Å–ª–∏ –µ—Å—Ç—å)
      const prods = products.filter(p => p.category === cat.name && (!p.subcategory || p.subcategory === "" || p.subcategory === null));
      if (prods.length > 0) {
        html += `<h3 style="margin:10px 0 3px 0;color:#888;">–¢–æ–≤–∞—Ä—ã</h3>`;
        html += `<div class="products-list">` +
          prods.map((p, idx) => productCard(p, products.indexOf(p))).join("") +
          `</div>`;
      }
      document.getElementById("app").innerHTML = html;
    }

    window.goToSubcategory = function(catIndex, subcatIndex) {
      const cat = categories[catIndex];
      const subcat = cat.subcategories[subcatIndex];
      navStack.push({type:"subcategory", catIndex, subcatIndex});
      renderProductsList(cat.name, subcat, cat.name + " / " + subcat, catIndex, subcatIndex);
    }

    function renderProductsList(catName, subcatName, title, catIndex, subcatIndex) {
      let html = `<button class="nav-back" onclick="navBack()">‚Üê –ù–∞–∑–∞–¥</button>`;
      html += `<h2 style="margin-top:0;">${title}</h2>`;
      let filtered = products.filter(p => p.category === catName && (subcatName ? p.subcategory === subcatName : (!p.subcategory || p.subcategory === "" || p.subcategory === null)));
      if(filtered.length === 0){
        html += `<div style="margin:15px 0;">–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤.</div>`;
      } else {
        html += `<div class="products-list">` +
          filtered.map((p, idx) => productCard(p, products.indexOf(p))).join("") +
          `</div>`;
      }
      document.getElementById("app").innerHTML = html;
    }

    window.navBack = function() {
      if(navStack.length === 0) { renderCategories(); return; }
      const last = navStack.pop();
      if(!last) { renderCategories(); return; }
      if(last.type === "root") { renderCategories(); }
      if(last.type === "category") {
        renderCategories();
      }
      if(last.type === "subcategory") {
        renderSubcategories(categories[last.catIndex], last.catIndex);
      }
    }

    function productCard(p, idx) {
      let priceLabel = "";
      let inputHtml = "";

      if (p.unit === "perKg") {
        priceLabel = `–¶–µ–Ω–∞ –∑–∞ 1 –∫–≥: ${p.price}‚ÇΩ`;
        inputHtml = `<input type="number" id="w${idx}" min="1" max="10000" value="500" step="50" placeholder="–ì—Ä–∞–º–º—ã (–≥)"><span> –≥</span>`;
      } else if (p.unit === "per100g") {
        priceLabel = `–¶–µ–Ω–∞ –∑–∞ 100 –≥: ${p.price}‚ÇΩ`;
        inputHtml = `<input type="number" id="w${idx}" min="50" max="5000" value="100" step="50" placeholder="–ì—Ä–∞–º–º—ã (–≥)"><span> –≥</span>`;
      } else {
        priceLabel = `–¶–µ–Ω–∞ –∑–∞ —à—Ç: ${p.price}‚ÇΩ`;
        inputHtml = `<input type="number" id="w${idx}" min="1" max="100" value="1" step="1" placeholder="–®—Ç"><span> —à—Ç</span>`;
      }

      return `
        <div class="product-card">
          <div><strong>${p.name}</strong></div>
          <div>${priceLabel}</div>
          ${p.image ? `<img src="${p.image}" style="max-width:80px;max-height:80px;margin:7px 0;">` : ""}
          <div style="margin: 5px 0;">${inputHtml}</div>
          <button onclick="addToCart(${idx})">–í –∫–æ—Ä–∑–∏–Ω—É</button>
        </div>
      `;
    }

    // --- –ü–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º —Ç–æ–≤–∞—Ä–∞–º
    document.getElementById('search').addEventListener('input', function() {
      let searchValue = this.value.toLowerCase();
      if(!searchValue) { renderCategories(); return; }
      let filtered = products.filter(p => p.name.toLowerCase().includes(searchValue));
      let html = `<button class="nav-back" onclick="renderCategories()">‚Üê –ù–∞–∑–∞–¥</button>`;
      html += `<h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</h2>`;
      if(filtered.length === 0){
        html += `<div style="margin:15px 0;">–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤.</div>`;
      } else {
        html += `<div class="products-list">` +
          filtered.map((p, idx) => productCard(p, products.indexOf(p))).join("") +
          `</div>`;
      }
      document.getElementById("app").innerHTML = html;
    });

    // --- –ö–æ—Ä–∑–∏–Ω–∞
    document.getElementById("cart-btn").onclick = function () {
      window.location.href = "cart.html";
    };
    // --- –õ–æ–≥–æ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ –∏ –≤–µ–¥—ë—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é
    document.querySelector('.logo-img').onclick = function() {
      renderCategories();
      document.getElementById('search').value = "";
    };
    // --- –ö–Ω–æ–ø–∫–∏ –≤—Ö–æ–¥/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/—Ç–µ–ª–µ—Ñ–æ–Ω/WhatsApp
    document.getElementById('login-btn').onclick = function() {
      alert('–ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ–∫–Ω–æ –≤—Ö–æ–¥–∞ (–º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–ª–∏ popup).');
    };
    document.getElementById('register-btn').onclick = function() {
      alert('–ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ–∫–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (–º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–ª–∏ popup).');
    };
    document.getElementById('phone-btn').onclick = function() {
      window.location.href = 'tel:+373xxxxxxxx'; // ‚Üê –í–ø–∏—à–∏ —Ç–≤–æ–π –Ω–æ–º–µ—Ä!
    };
    document.getElementById('whatsapp-btn').onclick = function() {
      window.open('https://wa.me/373xxxxxxxx', '_blank'); // ‚Üê –í–ø–∏—à–∏ —Ç–≤–æ–π –Ω–æ–º–µ—Ä!
    };
    // --- –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É
    function addToCart(idx) {
      const p = products[idx];
      const input = document.getElementById("w" + idx);
      let quantity = Number(input.value);

      if (p.unit === "perKg" || p.unit === "per100g") {
        if (isNaN(quantity) || quantity <= 0) return alert("–£–∫–∞–∂–∏—Ç–µ –≤–µ—Å –≤ –≥—Ä–∞–º–º–∞—Ö!");
      } else {
        quantity = Math.max(1, Math.floor(quantity));
        if (isNaN(quantity) || quantity <= 0) return alert("–£–∫–∞–∂–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ!");
      }

      let key = p.name + '_' + (p.unit) + '_' + quantity;
      let exists = cart.find(item => item.key === key);
      let priceForQuantity = 0;

      if (p.unit === "perKg") {
        priceForQuantity = Math.round((p.price / 1000) * quantity);
      } else if (p.unit === "per100g") {
        priceForQuantity = Math.round((p.price / 100) * quantity);
      } else {
        priceForQuantity = p.price * quantity;
      }

      if (exists) {
        exists.quantity += quantity;
        exists.sum += priceForQuantity;
      } else {
        cart.push({
          key,
          name: p.name,
          unit: p.unit,
          img: p.image,
          quantity,
          price: p.price,
          priceForQuantity,
          sum: priceForQuantity
        });
      }
      saveCart();
      alert("–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É");
    }

    // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    window.onload = function () {
      updateCartBtn();
      renderCategories();
    };
  </script>
</body>
</html>
